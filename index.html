<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>AVA â€“ Cotizar Seguro de Auto</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:   #0A1F44;
  --blue:   #165DFF;
  --blue2:  #0A40CC;
  --white:  #FFFFFF;
  --light:  #F4F7FF;
  --border: #D6E0FF;
  --muted:  #6B7A99;
  --dark:   #1a1a2e;
  --radius: 14px;
  --shadow: 0 8px 32px rgba(10,31,68,.10);
  --green:  #22c55e;
  --yellow: #eab308;
  --red:    #ef4444;
  --font-display: 'Outfit', sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--light);
  color: var(--dark);
  min-height: 100vh;
  transition: background .3s, color .3s;
}

/* â”€â”€ DARK MODE â”€â”€ */
body.dark {
  --navy:   #c8d6f0;
  --white:  #111827;
  --light:  #0c1525;
  --border: #1e2d50;
  --muted:  #7a8fb0;
  --dark:   #d0d8ec;
  --shadow: 0 8px 40px rgba(0,0,0,.4);
  background: #0c1525;
  color: #c8d6f0;
}
body.dark .card          { background: #111f38; }
body.dark header         { background: linear-gradient(135deg,#040d1e,#071430,#091a3e); }
body.dark label          { color: #8ba4cc; }
body.dark input,
body.dark select         { background: #162040; border-color: #243660; color: #d0d8ec; }
body.dark input:focus,
body.dark select:focus   { background: #1a2850; border-color: #4d8aff; }
body.dark input::placeholder { color: #3a4e70; }
body.dark .lada          { background: #1e2d45; }
body.dark .phone-wrap    { border-color: #243660; }
body.dark .brand-drop    { background: #162040; border-color: #4d8aff; }
body.dark .brand-item:hover { background: #1e2d45; }
body.dark .cp-box        { background: #1e2d45; border-color: #243660; color: #c8d6f0; }
body.dark .colonia-sel   { background: #162040; border-color: #4d8aff; color: #d0d8ec; }
body.dark .attach-dropzone { border-color: #243660; background: #111f38; }
body.dark .attach-file-item { background: #1e2d45; border-color: #263558; }
body.dark .attach-file-name { color: #c8d6f0; }
body.dark .attach-bar-track { background: #1e2d45; }
body.dark .compress-progress { border-color: #243660; }
body.dark .compress-body { background: #111f38; }
body.dark .compress-stat-val { color: #c8d6f0; }
body.dark .decl-wrap     { background: #1a2645; border-color: #243660; }
body.dark .decl-text     { color: #c8d6f0; }
body.dark .modal-box     { background: #111827; }
body.dark .modal-title   { color: #c8d6f0; }
body.dark .modal-body strong { color: #c8d6f0; }
body.dark .modal-tag     { background: #1e2d45; border-color: #263558; color: #c8d6f0; }
body.dark .auth-note     { background: rgba(77,138,255,.07); border-color: #4d8aff; }
body.dark .auth-title    { color: #c8d6f0; }
body.dark .legible-ok    { background: #0f2a1a; border-color: #166534; color: #86efac; }
body.dark .legible-no    { background: #2a0f0f; border-color: #991b1b; color: #fca5a5; }
body.dark .field-ok      { background: #0f2a1a !important; border-color: #22c55e !important; }
body.dark .field-err     { background: #2a0f0f !important; border-color: #ef4444 !important; }
body.dark .fmt-box       { background: rgba(22,93,255,.08); border-color: rgba(22,93,255,.25); }
body.dark .fmt-body      { color: #8ba4cc; }
body.dark .fmt-title     { color: #c8d6f0; }
body.dark .req-body      { background: #111f38; }
body.dark .req-item      { color: #c8d6f0; }
body.dark .docs-block    { border-color: #243660; }
body.dark .auto-fill     { background: #0f2a1a; border-color: #22c55e; color: #c8d6f0; }
body.dark .prog-pill     { background: #1a2645; border-color: rgba(255,255,255,.12); }
body.dark .prog-track    { background: #263558; }
body.dark .prog-txt      { color: #c8d6f0; }
body.dark .prog-txt strong { color: #78b0ff; }
body.dark .zip-note      { background: rgba(22,93,255,.07); border-color: rgba(22,93,255,.2); }
body.dark input.uf       { border-color: #22c55e; background: #0f2a1a; color: #c8d6f0; font-weight: 500; }
body.dark input.uw       { background: #111827; color: #3a4e70; }

/* â”€â”€ SUMBOX dark mode â”€â”€ */
body.dark .sumbox        { background: #111f38; border-color: #1e2d50; }
body.dark .sum-grp + .sum-grp { border-top-color: rgba(255,255,255,.06); }
body.dark .sg-label-ico  { background: rgba(22,93,255,.16); }
body.dark .sum-row       { background: rgba(255,255,255,.025); }
body.dark .sum-row:hover { background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.08); }
body.dark .sum-v         { color: #c8d6f0; }
body.dark .sum-v.empty   { color: #3a4e70; }
body.dark .sum-chip.files { color: #4ade80; background: rgba(34,197,94,.12); border-color: rgba(34,197,94,.25); }
body.dark .sum-footer    { background: rgba(255,255,255,.02); border-top-color: rgba(255,255,255,.06); }
body.dark .sum-footer-txt strong { color: #c8d6f0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.theme-btn {
  position: fixed; top: 16px; right: 16px; z-index: 9999;
  width: 50px; height: 50px; border-radius: 50%;
  border: none; cursor: pointer; outline: none;
  background: linear-gradient(145deg,#e8ecf4,#d0d6e8);
  box-shadow: 0 4px 16px rgba(0,0,0,.15), inset 0 -2px 4px rgba(0,0,0,.1), inset 0 2px 4px rgba(255,255,255,.8);
  display: flex; align-items: center; justify-content: center;
  transition: transform .2s;
}
.theme-btn:hover { transform: scale(1.08); }
body.dark .theme-btn { background: linear-gradient(145deg,#1e2d50,#0f1d38); box-shadow: 0 4px 16px rgba(0,0,0,.4); }
.th-icon { width: 22px; height: 22px; transition: all .35s cubic-bezier(.68,-.55,.27,1.55); }
.sun { opacity:1; transform:scale(1) rotate(0); }
.moon { position: absolute; opacity:0; transform:scale(.3) rotate(-80deg); }
body.dark .sun  { opacity:0; transform:scale(.3) rotate(80deg); }
body.dark .moon { opacity:1; transform:scale(1) rotate(0); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  background: linear-gradient(135deg,#0A1F44,#0d2554,#112A5E);
  padding: 52px 20px 70px;
  text-align: center;
  position: relative;
  overflow: hidden;
  clip-path: ellipse(110% 100% at 50% 0%);
  margin-bottom: -28px;
}
header::before {
  content:'';position:absolute;inset:0;
  background: radial-gradient(ellipse at 75% 40%,rgba(22,93,255,.28) 0%,transparent 55%),
              radial-gradient(ellipse at 20% 70%,rgba(22,93,255,.14) 0%,transparent 45%);
}
header::after {
  content:'';position:absolute;inset:0;pointer-events:none;
  background-image: repeating-linear-gradient(-45deg,transparent,transparent 18px,rgba(255,255,255,.02) 18px,rgba(255,255,255,.02) 19px);
}
.h-inner { position:relative; z-index:2; }
.h-bar { display:inline-block; width:44px; height:3px; background:var(--blue); border-radius:2px; margin-bottom:16px; }
.logo { font-family:'Playfair Display',serif; font-size:clamp(2.4rem,6vw,3.6rem); font-weight:900; color:#fff; letter-spacing:8px; line-height:1; }
.logo span { color:var(--blue); }
.sub { color:rgba(255,255,255,.6); font-size:.78rem; letter-spacing:4px; text-transform:uppercase; margin-top:14px; font-weight:500; }
.badge {
  display:inline-flex; align-items:center; gap:7px;
  margin-top:16px; background:rgba(22,93,255,.18);
  border:1px solid rgba(22,93,255,.42); border-radius:99px;
  padding:6px 18px; font-size:.73rem; color:rgba(255,255,255,.78);
  letter-spacing:1.5px; text-transform:uppercase;
}
.badge-dot {
  width:7px; height:7px; background:#4ade80; border-radius:50%;
  animation: pdot 2s ease-in-out infinite;
}
@keyframes pdot { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.4)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTAINER & CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.container { max-width:900px; margin:36px auto 120px; padding:0 16px; }

.card {
  background: var(--white);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 36px 40px;
  margin-bottom: 28px;
}
@media(max-width:600px){ .card { padding:24px 18px; } }

.sec-title {
  display:flex; align-items:center; gap:12px;
  font-size:.92rem; font-weight:700; color:var(--navy);
  letter-spacing:2px; text-transform:uppercase;
  padding-bottom:16px; margin-bottom:28px;
  border-bottom:2px solid var(--blue);
}
.sec-icon {
  width:36px; height:36px; background:var(--light);
  border-radius:10px; display:flex; align-items:center; justify-content:center;
  font-size:1.1rem; flex-shrink:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRID & FIELDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.g2 { display:grid; grid-template-columns:1fr 1fr; gap:22px; }
@media(max-width:680px){ .g2 { grid-template-columns:1fr; } }

.field { display:flex; flex-direction:column; gap:7px; }
label { font-size:.82rem; font-weight:600; color:var(--navy); letter-spacing:.4px; }
.req { color:var(--blue); margin-left:2px; }
.opt { color:var(--muted); font-weight:400; font-size:.76rem; margin-left:4px; }

input[type=text],
input[type=email],
input[type=date],
select {
  width:100%; padding:13px 16px;
  border:1.5px solid var(--border); border-radius:10px;
  font-family:'DM Sans',sans-serif; font-size:.93rem; color:var(--dark);
  background:var(--white); outline:none; appearance:none;
  transition:border-color .2s, box-shadow .2s, background .2s;
}
input:focus, select:focus {
  border-color:var(--blue);
  box-shadow:0 0 0 3px rgba(22,93,255,.11);
}
input::placeholder { color:var(--muted); }
select { cursor:pointer; }

.up { text-transform:uppercase; }
.up::placeholder { text-transform:none; }

.uf { border-color:var(--green)!important; background:#f0fdf4!important; color:#166534!important; font-weight:500; }
.uf:focus { box-shadow:0 0 0 3px rgba(34,197,94,.1)!important; }
.uw { background:#fafbff!important; color:var(--muted)!important; cursor:not-allowed!important; }
.af-hint { font-size:.74rem; color:var(--muted); display:flex; align-items:center; gap:5px; margin-top:4px; }
.af-hint.ready { color:var(--green); font-weight:600; }
.af-dot { width:6px; height:6px; border-radius:50%; background:var(--border); flex-shrink:0; }
.af-hint.ready .af-dot { background:var(--green); }

.fhint { font-size:.74rem; margin-top:4px; min-height:16px; display:flex; align-items:center; gap:5px; }
.fhint.ok  { color:var(--green); font-weight:600; }
.fhint.err { color:var(--red);   font-weight:600; }
input.field-ok  { border-color:var(--green)!important; background:#f0fdf4!important; }
input.field-err { border-color:var(--red)!important;   background:#fff1f1!important; }

/* PHONE */
.phone-wrap {
  display:flex; border:1.5px solid var(--border); border-radius:10px; overflow:hidden;
}
.phone-wrap:focus-within { border-color:var(--blue); box-shadow:0 0 0 3px rgba(22,93,255,.11); }
.lada {
  border:none!important; border-right:1.5px solid var(--border)!important;
  border-radius:0!important; width:200px; min-width:130px;
  background:var(--light); padding:13px 14px;
  font-family:'DM Sans',sans-serif; font-size:.93rem; color:var(--dark);
  cursor:pointer; outline:none; appearance:none; flex-shrink:0;
}
.lada:focus { box-shadow:none!important; }
.phone-inp { border:none!important; border-radius:0!important; flex:1; min-width:0; }
.phone-inp:focus { box-shadow:none!important; }

/* CP */
.helper { font-size:.74rem; color:var(--muted); margin-top:2px; }
.cp-load { display:none; font-size:.82rem; color:var(--muted); margin-top:4px; }
.cp-load.on { display:block; }
.cp-err { display:none; font-size:.82rem; color:var(--red); margin-top:4px; }
.cp-err.on { display:block; }
.cp-box { display:none; background:var(--light); border:1.5px solid var(--border); border-radius:10px; padding:12px 16px; font-size:.87rem; color:var(--navy); line-height:1.7; margin-top:4px; }
.cp-box.on { display:block; }
.cp-badge { display:inline-block; background:var(--blue); color:#fff; border-radius:6px; padding:2px 8px; font-size:.74rem; font-weight:700; margin-right:6px; }
.col-wrap { display:none; margin-top:10px; }
.col-wrap.on { display:block; }
.col-lbl { font-size:.8rem; font-weight:600; color:var(--navy); margin-bottom:6px; display:flex; align-items:center; gap:6px; }
.col-lbl span { background:var(--blue); color:#fff; border-radius:99px; padding:1px 8px; font-size:.7rem; font-weight:700; }
.colonia-sel {
  width:100%; padding:11px 16px; border:1.5px solid var(--blue); border-radius:10px;
  font-family:'DM Sans',sans-serif; font-size:.9rem; color:var(--dark);
  background:var(--white); cursor:pointer; outline:none; appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='%23165DFF' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:right 14px center; background-size:16px;
}
.colonia-sel:focus { box-shadow:0 0 0 3px rgba(22,93,255,.11); }

/* BRAND */
.brand-wrap { position:relative; }
.brand-drop {
  position:absolute; top:calc(100% + 4px); left:0; right:0;
  background:var(--white); border:1.5px solid var(--blue); border-radius:10px;
  box-shadow:0 12px 28px rgba(10,31,68,.15); max-height:220px; overflow-y:auto;
  z-index:200; display:none;
}
.brand-drop.open { display:block; }
.brand-cat { padding:7px 14px 3px; font-size:.7rem; font-weight:700; color:var(--muted); letter-spacing:1.5px; text-transform:uppercase; }
.brand-item { padding:10px 16px; font-size:.9rem; cursor:pointer; display:flex; align-items:center; gap:10px; transition:background .15s; }
.brand-item:hover { background:var(--light); }
.brand-flag { font-size:1.1rem; }
.otra-wrap { display:none; }
.otra-wrap.on { display:block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILE UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.attach-dropzone {
  border: 2.5px dashed var(--border);
  border-radius: 16px; padding: 28px 20px;
  text-align: center; cursor: pointer;
  transition: all 0.3s; background: var(--light);
  position: relative; overflow: hidden;
}
.attach-dropzone:hover,
.attach-dropzone.drag-over { border-color: var(--blue); background: rgba(22,93,255,.04); }
.attach-dropzone.drag-over::before {
  content: 'Suelta aquÃ­'; position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; font-weight: 700; color: var(--blue);
  background: rgba(22,93,255,.08); border-radius: 13px;
}
.attach-folder-icon { font-size: 44px; margin-bottom: 10px; display: block; }
.attach-dropzone-text { font-size: 14px; color: var(--muted); line-height: 1.6; }
.attach-dropzone-text a { color: var(--blue); font-weight: 600; cursor: pointer; text-decoration: none; }
.attach-formats-line { margin-top: 8px; font-size: 12.5px; color: var(--muted); }
.attach-auto-compress-line { font-size: 12.5px; color: var(--blue); font-weight: 600; margin-top: 4px; }
.attach-limit-line { font-size: 12.5px; color: var(--muted); margin-top: 4px; }
.attach-realtime-stats {
  display: none; margin-top: 10px; gap: 12px;
  justify-content: center; align-items: center;
  font-size: 12.5px; color: var(--muted);
}
.attach-stats-sep { color: var(--border); }
.attach-limit-exceeded {
  margin-top: 8px; color: var(--red); font-size: 12.5px; font-weight: 600; display: none;
}

.attach-capacity-wrap { margin-top: 16px; display: none; }
.attach-capacity-wrap.visible { display: block; }
.attach-capacity-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12.5px; font-weight: 600; color: var(--navy); }
.attach-capacity-label { font-weight: 600; }
.attach-bar-track { height: 10px; background: #e8edf7; border-radius: 99px; overflow: hidden; }
.attach-bar-fill {
  height: 100%; border-radius: 99px;
  transition: width 0.4s ease;
  position: relative; overflow: hidden;
}
.attach-bar-fill::after {
  content: ''; position: absolute; top: 0; left: -60px;
  width: 50px; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.4), transparent);
  animation: barShine 2s infinite;
}
@keyframes barShine { 0%{left:-60px} 100%{left:calc(100% + 20px)} }
.attach-bar-fill.green  { background: linear-gradient(90deg,#0FC373,#12e080); }
.attach-bar-fill.yellow { background: linear-gradient(90deg,#F59E0B,#fbbf24); }
.attach-bar-fill.red    { background: linear-gradient(90deg,#FF4757,#ff6370); animation: none; }
.attach-bar-fill.red::after { display: none; }

.attach-status { margin-top: 6px; font-size: 12.5px; display: flex; align-items: center; gap: 6px; }
.attach-status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.attach-status-dot.green  { background: #0FC373; }
.attach-status-dot.yellow { background: #F59E0B; }
.attach-status-dot.red    { background: #FF4757; animation: pulseRed 1s infinite; }
@keyframes pulseRed { 0%,100%{opacity:1} 50%{opacity:.4} }

.attach-error-msg {
  background: rgba(255,71,87,.08); border: 1.5px solid rgba(255,71,87,.3);
  border-radius: 10px; padding: 10px 14px; font-size: 12.5px; color: #d93546;
  margin-top: 10px; display: none; align-items: center; gap: 8px;
}
.attach-error-msg.show { display: flex; }

.attach-file-list { margin-top: 12px; display: flex; flex-direction: column; gap: 6px; }
.attach-file-item {
  display: flex; align-items: center; gap: 10px;
  background: var(--light); border: 1px solid var(--border);
  border-radius: 10px; padding: 9px 12px;
}
.attach-file-icon { font-size: 1.1rem; flex-shrink: 0; }
.attach-file-name { flex: 1; font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--navy); }
.attach-file-size { font-size: 12px; color: var(--muted); flex-shrink: 0; }
.attach-file-remove {
  width: 24px; height: 24px; border-radius: 50%; border: none;
  background: rgba(255,71,87,.1); color: #FF4757;
  cursor: pointer; font-size: 14px; transition: all .2s; flex-shrink: 0;
}
.attach-file-remove:hover { background: #FF4757; color: #fff; }

.offline-msg {
  background: rgba(255,71,87,.08); border: 1.5px solid rgba(255,71,87,.25);
  border-radius: 10px; padding: 10px 14px; font-size: 12.5px; color: #d93546;
  margin-top: 10px; display: none; align-items: center; gap: 8px;
}
.offline-msg.show { display: flex; }

.compress-progress { display: none; border: 1.5px solid var(--border); border-radius: 14px; overflow: hidden; margin-top: 14px; }
.compress-progress.show { display: block; }
.compress-header { background: var(--navy); padding: 12px 16px; display: flex; align-items: center; gap: 8px; }
.compress-header-text { font-size: 12px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: #fff; }
.compress-pct { font-weight: 700; color: #78b0ff; font-size: 12.5px; margin-left: auto; }
.compress-body { padding: 14px 16px; background: var(--white); }
.compress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.compress-stat { text-align: center; }
.compress-stat-val { font-size: 16px; font-weight: 800; color: var(--navy); }
.compress-stat-label { font-size: 10.5px; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-top: 2px; }
.compress-bar-track { height: 8px; background: #e8edf7; border-radius: 99px; overflow: hidden; margin-bottom: 8px; }
.compress-bar-fill {
  height: 100%; background: linear-gradient(90deg,var(--blue),#3a7fff);
  border-radius: 99px; width: 0%; transition: width .3s ease;
  position: relative; overflow: hidden;
}
.compress-bar-fill::after {
  content: ''; position: absolute; top: 0; left: -60px;
  width: 50px; height: 100%;
  background: linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);
  animation: barShine 1.5s infinite;
}
.compress-info { display: flex; justify-content: space-between; font-size: 11.5px; color: var(--muted); }
.compress-resume-note {
  background: rgba(245,158,11,.1); border: 1px solid rgba(245,158,11,.3);
  border-radius: 8px; padding: 8px 12px; font-size: 12px; color: #92400e;
  margin-top: 8px; display: none; align-items: center; gap: 6px;
}
.compress-resume-note.show { display: flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCS REQUIRED BLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.docs-block { border-radius:12px; overflow:hidden; border:1.5px solid var(--border); margin-bottom:14px; }
.docs-head { background:linear-gradient(135deg,var(--navy),#0e2a60); padding:14px 20px; display:flex; align-items:center; gap:10px; }
.docs-head-ico { width:32px; height:32px; background:rgba(255,255,255,.12); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:1rem; flex-shrink:0; }
.docs-head-txt { font-size:.82rem; font-weight:800; color:#fff; letter-spacing:.07em; text-transform:uppercase; }
.req-body { background:var(--white); padding:16px 20px; display:flex; flex-direction:column; gap:10px; }
.req-item { display:flex; align-items:center; gap:10px; font-size:.85rem; color:var(--navy); font-weight:500; }
.req-item-ico { width:28px; height:28px; background:rgba(22,93,255,.1); border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:.9rem; flex-shrink:0; }

.fmt-box { background:#EEF4FF; border:1.5px solid #B8D0FF; border-radius:12px; padding:16px 20px; margin-bottom:14px; }
.fmt-title { display:flex; align-items:center; gap:7px; font-size:.8rem; font-weight:800; color:var(--navy); letter-spacing:.06em; text-transform:uppercase; margin-bottom:10px; }
.fmt-body { font-size:.82rem; color:#2a4480; line-height:1.75; }
.fmt-body strong { color:var(--navy); }
.fmt-link { color:var(--blue); font-weight:700; text-decoration:none; }
.fmt-link:hover { text-decoration:underline; }

.auth-note { margin-top:14px; border-left:3px solid var(--blue); padding:14px 18px; background:rgba(22,93,255,.04); border-radius:0 10px 10px 0; }
.auth-title { display:flex; align-items:center; gap:8px; font-size:.84rem; font-weight:700; color:var(--navy); margin-bottom:10px; }
.legible-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
@media(max-width:560px){ .legible-grid { grid-template-columns:1fr; } }
.legible-ok, .legible-no { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; border-radius:10px; font-size:.82rem; line-height:1.55; }
.legible-ok { background:#f0fdf4; border:1.5px solid #bbf7d0; color:#166534; }
.legible-no { background:#fff1f1; border:1.5px solid #fecaca; color:#991b1b; }
.l-ico { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1rem; flex-shrink:0; margin-top:1px; }
.legible-ok .l-ico { background:#22c55e; color:#fff; }
.legible-no .l-ico { background:#ef4444; color:#fff; }
.l-ttl { font-weight:700; font-size:.86rem; margin-bottom:3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUMBOX â€” NUEVO DISEÃ‘O PREMIUM
   Estructura: .sumbox > .sum-hd + [sum-grp*] + .sum-footer
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sumbox {
  background: var(--white);
  border: 1.5px solid rgba(22,93,255,.13);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 40px rgba(10,31,68,.13), 0 1px 6px rgba(10,31,68,.06);
  margin-top: 32px;
  animation: sumboxReveal .4s ease forwards;
  transition: background .3s, border-color .3s;
}

@keyframes sumboxReveal {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â”€â”€ Encabezado del resumen â”€â”€ */
.sum-hd {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.2rem 1.6rem;
  background: linear-gradient(120deg,#071430 0%,#0e2a60 55%,#0d3070 100%);
  position: relative; overflow: hidden;
}
.sum-hd::before {
  content: ''; position: absolute; inset: 0; pointer-events: none;
  background:
    radial-gradient(ellipse at 80% 50%, rgba(77,138,255,.22) 0%, transparent 55%),
    radial-gradient(ellipse at 10% 80%, rgba(22,93,255,.12) 0%, transparent 45%);
}
.sum-hd::after {
  content: ''; position: absolute; inset: 0; pointer-events: none;
  background-image: repeating-linear-gradient(-45deg,transparent,transparent 22px,rgba(255,255,255,.015) 22px,rgba(255,255,255,.015) 23px);
}
.sum-hd-left {
  display: flex; align-items: center; gap: .75rem;
  position: relative; z-index: 1;
}
.sum-hd-icon {
  width: 38px; height: 38px; border-radius: 10px; flex-shrink: 0;
  background: rgba(255,255,255,.1);
  border: 1px solid rgba(255,255,255,.15);
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(4px);
}
.sum-hd-icon svg { width: 18px; height: 18px; fill: #fff; }
.sum-ttl {
  font-family: var(--font-display);
  font-size: .86rem; font-weight: 800; color: #fff;
  letter-spacing: .07em; text-transform: uppercase; line-height: 1.2;
}
.sum-sub { font-size: .67rem; color: rgba(255,255,255,.45); margin-top: .2rem; letter-spacing: .02em; }

/* â”€â”€ Badge de estado (3 variantes) â”€â”€ */
.sum-badge {
  display: inline-flex; align-items: center; gap: 6px;
  border-radius: 99px; padding: 5px 13px;
  font-family: var(--font-display);
  font-size: .68rem; font-weight: 800;
  letter-spacing: .05em; text-transform: uppercase;
  position: relative; z-index: 1;
  backdrop-filter: blur(6px);
  transition: background .4s ease, border-color .4s ease, color .4s ease;
}
.sum-badge.pending {
  background: rgba(107,114,128,.15); border: 1px solid rgba(107,114,128,.35); color: #9CA3AF;
}
.sum-badge.pending .badge-dot { background: #9CA3AF; animation: blinkGray 2s ease-in-out infinite; }
.sum-badge.warn {
  background: rgba(245,158,11,.16); border: 1px solid rgba(245,158,11,.4); color: #fcd34d;
}
.sum-badge.warn .badge-dot { background: #F59E0B; animation: blinkAmber 1.4s ease-in-out infinite; }
.sum-badge.ok {
  background: rgba(15,195,115,.18); border: 1px solid rgba(15,195,115,.4); color: #6eeabb;
}
.sum-badge.ok .badge-dot { background: #0FC373; animation: blinkGreen 2s ease-in-out infinite; }

.badge-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
@keyframes blinkGray  { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.25;transform:scale(.8)} }
@keyframes blinkAmber { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.2;transform:scale(.75)} }
@keyframes blinkGreen { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.85)} }

/* â”€â”€ Grupos dentro del resumen â”€â”€ */
.sum-grp { padding: 1.1rem 1.6rem; position: relative; }
.sum-grp + .sum-grp { border-top: 1px solid rgba(22,93,255,.07); }

.sum-grp-lbl {
  display: flex; align-items: center; gap: .5rem; margin-bottom: .85rem;
}
.sum-grp-lbl-ico {
  width: 26px; height: 26px; border-radius: 7px;
  background: rgba(22,93,255,.08);
  display: flex; align-items: center; justify-content: center;
  font-size: .82rem; flex-shrink: 0;
}
.sum-grp-lbl-txt {
  font-family: var(--font-display);
  font-size: .65rem; font-weight: 900; color: var(--blue);
  letter-spacing: .12em; text-transform: uppercase;
}

/* â”€â”€ Filas claveâ€“valor con hover card â”€â”€ */
.sum-row {
  display: flex; flex-direction: column;
  gap: .06rem; padding: .42rem .6rem;
  border-radius: 8px;
  background: rgba(22,93,255,.025);
  border: 1px solid transparent;
  transition: background .18s, border-color .18s;
  margin-bottom: .25rem;
}
.sum-row:last-child { margin-bottom: 0; }
.sum-row:hover { background: rgba(22,93,255,.055); border-color: rgba(22,93,255,.1); }

/* AnimaciÃ³n de flash al actualizar */
@keyframes rowFlash {
  0%   { background: rgba(22,93,255,.12); }
  100% { background: rgba(22,93,255,.025); }
}
.sum-row.row-updated { animation: rowFlash .6s ease forwards; }

.sum-k {
  font-size: .68rem; font-weight: 600; color: var(--muted);
  letter-spacing: .02em; white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis; line-height: 1.3;
}
.sum-v {
  font-size: .84rem; font-weight: 700; color: var(--dark);
  word-break: break-word; line-height: 1.35; text-transform: uppercase;
  transition: color .3s;
}
.sum-v.empty {
  font-size: .78rem; font-weight: 400;
  color: #b0bdd6; font-style: italic; text-transform: none;
}

/* Chips */
.sum-chip {
  display: inline-flex; align-items: center;
  background: rgba(22,93,255,.09); color: var(--blue);
  border: 1px solid rgba(22,93,255,.2); border-radius: 6px;
  padding: .12rem .55rem; font-size: .72rem; font-weight: 700;
  letter-spacing: .02em; text-transform: none;
}
.sum-chip.files {
  background: rgba(15,195,115,.09); color: #0a7a49;
  border-color: rgba(15,195,115,.25);
}

/* â”€â”€ Footer del resumen â”€â”€ */
.sum-footer {
  border-top: 1px solid rgba(22,93,255,.08);
  padding: .9rem 1.6rem;
  background: linear-gradient(90deg, rgba(22,93,255,.03) 0%, transparent 100%);
  display: flex; align-items: flex-start; gap: .7rem;
}
.sum-footer-txt { font-size: .73rem; color: var(--muted); line-height: 1.65; }
.sum-footer-txt strong { color: var(--dark); font-weight: 700; }

@media(max-width:600px){
  .sum-grp  { padding: .9rem 1rem; }
  .sum-footer { padding: .8rem 1rem; }
  .sum-hd   { padding: 1rem 1.1rem; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DECLARATION & SUBMIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.decl-wrap {
  display:flex; align-items:flex-start; gap:12px;
  background:var(--light); border:1.5px solid var(--border);
  border-radius:12px; padding:16px 20px; margin-top:28px;
  cursor:pointer; transition:border-color .2s, background .2s;
}
.decl-wrap:hover { border-color:var(--blue); background:rgba(22,93,255,.03); }
.decl-wrap input[type=checkbox] { width:20px; height:20px; accent-color:var(--blue); cursor:pointer; flex-shrink:0; margin-top:2px; }
.decl-text { font-size:.85rem; color:var(--navy); line-height:1.6; }
.decl-text strong { color:var(--blue); }
.decl-text .decl-title { display:block; font-size:.9rem; font-weight:700; color:var(--navy); margin-bottom:6px; }

.btn-sub {
  display:block; width:100%; padding:18px; margin-top:18px;
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  color:#fff; font-family:'DM Sans',sans-serif; font-size:1rem; font-weight:700;
  letter-spacing:1px; border:none; border-radius:12px; cursor:pointer;
  box-shadow:0 8px 24px rgba(22,93,255,.35); transition:all .25s;
}
.btn-sub:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 14px 32px rgba(22,93,255,.45); }
.btn-sub:active:not(:disabled) { transform:translateY(0); }
.btn-sub:disabled { opacity:.42; cursor:not-allowed; transform:none; background:linear-gradient(135deg,#a0aec0,#718096); box-shadow:none; }
.btn-note { text-align:center; font-size:.77rem; color:var(--muted); margin-top:10px; }
.rc-note  { text-align:center; font-size:.71rem; color:var(--muted); margin-top:5px; }
.rc-note a { color:var(--blue); text-decoration:none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-wrap {
  position:fixed; bottom:28px; left:50%; transform:translateX(-50%);
  z-index:1500; width:calc(100% - 200px); max-width:720px; min-width:280px;
  display:none;
}
.prog-wrap.on { display:block; }
.prog-pill {
  background:#fff; border-radius:60px; padding:10px 20px 10px 16px;
  display:flex; align-items:center; gap:14px;
  box-shadow:0 4px 24px rgba(10,31,68,.12);
  border:1px solid rgba(10,31,68,.06);
}
.prog-track { flex:1; height:8px; background:#E8ECF4; border-radius:99px; overflow:hidden; }
.prog-fill { height:100%; background:linear-gradient(90deg,var(--blue),#3a7fff); border-radius:99px; width:0%; transition:width .4s cubic-bezier(.4,0,.2,1); }
.prog-txt { font-size:12px; font-weight:500; color:var(--muted); white-space:nowrap; min-width:130px; text-align:right; }
.prog-txt strong { color:var(--blue); font-weight:700; }
@media(max-width:640px){ .prog-wrap{width:calc(100% - 24px);bottom:16px;} .prog-txt{min-width:100px;font-size:11px;} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUCCESS MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-ov {
  position:fixed; inset:0; background:rgba(10,31,68,.55); backdrop-filter:blur(6px);
  display:flex; align-items:center; justify-content:center; z-index:9000;
  opacity:0; pointer-events:none; transition:opacity .35s ease;
}
.modal-ov.on { opacity:1; pointer-events:all; }
.modal-box {
  background:var(--white); border-radius:22px;
  box-shadow:0 30px 70px rgba(10,31,68,.25);
  padding:52px 44px 44px; max-width:480px;
  width:calc(100% - 32px); text-align:center;
  transform:scale(.88) translateY(20px);
  transition:transform .4s cubic-bezier(.34,1.56,.64,1);
}
.modal-ov.on .modal-box { transform:scale(1) translateY(0); }
.modal-check { width:80px; height:80px; border-radius:50%; background:linear-gradient(135deg,#22c55e,#16a34a); display:flex; align-items:center; justify-content:center; margin:0 auto 24px; box-shadow:0 8px 24px rgba(34,197,94,.35); animation:popIn .5s cubic-bezier(.34,1.56,.64,1) .2s both; }
@keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }
.modal-check svg { width:38px; height:38px; }
.modal-title { font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:900; color:var(--navy); margin-bottom:14px; line-height:1.2; }
.modal-bar { width:50px; height:3px; background:var(--blue); border-radius:2px; margin:0 auto 18px; }
.modal-body { font-size:.93rem; color:var(--muted); line-height:1.75; margin-bottom:24px; }
.modal-body strong { color:var(--navy); }
.modal-tag { display:inline-block; background:var(--light); border:1px solid var(--border); border-radius:8px; padding:10px 20px; font-size:.82rem; color:var(--navy); font-weight:600; margin-bottom:26px; }
.modal-btn { display:inline-block; padding:14px 36px; background:linear-gradient(135deg,var(--blue),var(--blue2)); color:#fff; font-family:'DM Sans',sans-serif; font-size:.92rem; font-weight:700; border:none; border-radius:10px; cursor:pointer; box-shadow:0 6px 18px rgba(22,93,255,.35); transition:all .2s; letter-spacing:.5px; }
.modal-btn:hover { transform:translateY(-2px); box-shadow:0 10px 24px rgba(22,93,255,.45); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLOATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wa-float {
  position:fixed; bottom:50px; left:50px;
  width:72px; height:72px; border-radius:50%; border:4px solid #fff;
  background:linear-gradient(135deg,#25d366,#128c7e);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 10px 28px rgba(37,211,102,.38); z-index:1000;
  cursor:pointer; text-decoration:none; overflow:hidden;
  animation:floatAnim 3s ease-in-out infinite;
}
.wa-float:hover { transform:scale(1.18) translateY(-5px); animation:none; }
.wa-tip { position:absolute; left:88px; background:#fff; color:#333; padding:12px 20px; border-radius:10px; white-space:nowrap; box-shadow:0 6px 20px rgba(0,0,0,.12); opacity:0; pointer-events:none; transition:all .35s ease; font-size:.95rem; font-weight:600; border:1px solid rgba(0,0,0,.08); }
.wa-float:hover .wa-tip { opacity:1; transform:translateX(8px); }
@keyframes floatAnim { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
@media(max-width:768px){ .wa-float{width:60px;height:60px;bottom:30px;left:20px;} .wa-tip{display:none;} }

.tr-float {
  position:fixed; top:50px; left:50px;
  width:72px; height:72px; border-radius:50%; border:4px solid #fff;
  background:linear-gradient(135deg,#0A1F44,#1a3a6e);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 10px 28px rgba(10,31,68,.38); z-index:1000;
  cursor:pointer; text-decoration:none; overflow:hidden;
  animation:floatAnim 3s ease-in-out infinite .5s;
}
.tr-float:hover { transform:scale(1.18) translateY(-5px); animation:none; }
.tr-tip { position:absolute; left:88px; background:#fff; color:#0A1F44; padding:12px 20px; border-radius:10px; white-space:nowrap; box-shadow:0 6px 20px rgba(0,0,0,.12); opacity:0; pointer-events:none; transition:all .35s ease; font-size:.95rem; font-weight:600; border:1px solid rgba(0,0,0,.08); }
.tr-float:hover .tr-tip { opacity:1; transform:translateX(8px); }
@media(max-width:768px){ .tr-float{width:60px;height:60px;top:20px;left:20px;} .tr-tip{display:none;} }
</style>
</head>
<body>

<!-- THEME TOGGLE -->
<button class="theme-btn" id="themeBtn" aria-label="Cambiar tema">
  <svg class="th-icon sun" viewBox="0 0 24 24" fill="none">
    <circle cx="12" cy="12" r="4.5" fill="#FFD700" stroke="#FFA500" stroke-width="1.3"/>
    <g stroke="#FFD700" stroke-width="1.9" stroke-linecap="round">
      <line x1="12" y1="2.5" x2="12" y2="4.5"/><line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(45 12 12)"/>
      <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(90 12 12)"/><line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(135 12 12)"/>
      <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(180 12 12)"/><line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(225 12 12)"/>
      <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(270 12 12)"/><line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(315 12 12)"/>
    </g>
  </svg>
  <svg class="th-icon moon" viewBox="0 0 24 24" fill="none" style="position:absolute">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="#c8d0ff" stroke="#4169E1" stroke-width="1.4"/>
  </svg>
</button>

<!-- TRAMITE FLOAT -->
<a href="https://www.anpai.com.mx/iniciar-tramite" class="tr-float" target="_blank" rel="noopener" aria-label="Iniciar trÃ¡mite">
  <span class="tr-tip">ğŸ“ Iniciar trÃ¡mite</span>
  <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
    <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
  </svg>
</a>

<!-- HEADER -->
<header>
  <div class="h-inner">
    <div class="h-bar"></div>
    <div class="logo"><span>A</span>VA</div>
    <div class="sub">Formulario Seguro de Auto â€” Cotizar</div>
    <div class="badge"><span class="badge-dot"></span> Formulario en lÃ­nea Â· Respuesta inmediata</div>
  </div>
</header>

<!-- FORM -->
<div class="container">
<form id="mainForm" action="https://formsubmit.co/info@anpai.com.mx" method="POST" enctype="multipart/form-data" novalidate>

  <input type="hidden" name="_subject"  value="Nueva CotizaciÃ³n de Seguro de Auto â€“ AVA">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_captcha"  value="false">
  <input type="hidden" name="g-recaptcha-response" id="rcToken">

  <!-- â”€â”€ DATOS PERSONALES â”€â”€ -->
  <div class="card">
    <div class="sec-title"><div class="sec-icon">ğŸ‘¤</div> Datos Personales</div>
    <div class="g2">
      <div class="field">
        <label for="fn">Primer Nombre <span class="req">*</span></label>
        <input type="text" id="fn" name="Primer Nombre" class="up" placeholder="Tu primer nombre" required>
      </div>
      <div class="field">
        <label for="sn">Segundo Nombre <span class="opt">(opcional)</span></label>
        <input type="text" id="sn" name="Segundo Nombre" class="up" placeholder="Tu segundo nombre">
      </div>
      <div class="field">
        <label for="fa">Primer Apellido <span class="req">*</span></label>
        <input type="text" id="fa" name="Primer Apellido" class="up" placeholder="Tu primer apellido" required>
      </div>
      <div class="field">
        <label for="sa">Segundo Apellido <span class="req">*</span></label>
        <input type="text" id="sa" name="Segundo Apellido" class="up" placeholder="Tu segundo apellido" required>
      </div>
      <div class="field">
        <label for="gen">GÃ©nero <span class="req">*</span></label>
        <select id="gen" name="GÃ©nero" required>
          <option value="">Seleccionaâ€¦</option>
          <option>Masculino</option>
          <option>Femenino</option>
        </select>
      </div>
      <div class="field">
        <label for="dob">Fecha de Nacimiento <span class="req">*</span></label>
        <input type="date" id="dob" name="Fecha de Nacimiento" required>
      </div>
      <div class="field">
        <label for="rfc">RFC <span class="req">*</span></label>
        <input type="text" id="rfc" name="RFC" class="up" placeholder="AAAA000000AAA" maxlength="13" required autocomplete="off">
        <div class="fhint" id="rfcHint"></div>
      </div>
      <div class="field">
        <label for="curp">CURP <span class="req">*</span></label>
        <input type="text" id="curp" name="CURP" class="up" placeholder="AAAA000000AAAAAA00" maxlength="18" required autocomplete="off">
        <div class="fhint" id="curpHint"></div>
      </div>
    </div>

    <!-- CP + Estado + Municipio -->
    <div style="margin-top:22px">
      <div class="g2">
        <div class="field">
          <label for="cp">CÃ³digo Postal <span class="req">*</span></label>
          <input type="text" id="cp" name="CÃ³digo Postal" placeholder="Ej. 06600" maxlength="5" required autocomplete="postal-code">
          <div class="helper">Ingresa 5 dÃ­gitos â€” Estado y Municipio se autocompletarÃ¡n</div>
          <div class="cp-load" id="cpLoad">ğŸ” Buscandoâ€¦</div>
          <div class="cp-err"  id="cpErr"></div>
          <div class="cp-box"  id="cpBox"></div>
          <div class="col-wrap" id="colWrap">
            <div class="col-lbl">Selecciona tu Colonia <span id="colBadge">0</span></div>
            <select class="colonia-sel" id="colSel" name="Colonia">
              <option value="">Elige tu coloniaâ€¦</option>
            </select>
          </div>
        </div>
        <div class="field"></div>
      </div>
      <div class="g2" style="margin-top:22px">
        <div class="field">
          <label for="estado">Estado <span class="req">*</span></label>
          <input type="text" id="estado" name="Estado" placeholder="Se autocompletarÃ¡ con tu CP" class="uw" readonly required>
          <div class="af-hint" id="estHint"><span class="af-dot"></span> Esperando cÃ³digo postalâ€¦</div>
        </div>
        <div class="field">
          <label for="mun">Municipio / AlcaldÃ­a <span class="req">*</span></label>
          <input type="text" id="mun" name="Municipio" placeholder="Se autocompletarÃ¡ con tu CP" class="uw" readonly required>
          <div class="af-hint" id="munHint"><span class="af-dot"></span> Esperando cÃ³digo postalâ€¦</div>
        </div>
      </div>
    </div>

    <!-- TelÃ©fono + Email -->
    <div class="g2" style="margin-top:22px">
      <div class="field">
        <label for="tel">TelÃ©fono <span class="req">*</span></label>
        <div class="phone-wrap">
          <select class="lada" id="lada" name="Lada">
            <optgroup label="â”€â”€ MÃ©xico â”€â”€">
              <option value="+52" selected>ğŸ‡²ğŸ‡½ +52 MÃ©xico</option>
            </optgroup>
            <optgroup label="â”€â”€ AmÃ©rica del Norte â”€â”€">
              <option value="+1">ğŸ‡¨ğŸ‡¦ +1 CanadÃ¡</option>
              <option value="+1">ğŸ‡ºğŸ‡¸ +1 EE.UU.</option>
            </optgroup>
            <optgroup label="â”€â”€ AmÃ©rica Central â”€â”€">
              <option value="+506">ğŸ‡¨ğŸ‡· +506 Costa Rica</option>
              <option value="+503">ğŸ‡¸ğŸ‡» +503 El Salvador</option>
              <option value="+502">ğŸ‡¬ğŸ‡¹ +502 Guatemala</option>
              <option value="+504">ğŸ‡­ğŸ‡³ +504 Honduras</option>
              <option value="+505">ğŸ‡³ğŸ‡® +505 Nicaragua</option>
              <option value="+507">ğŸ‡µğŸ‡¦ +507 PanamÃ¡</option>
            </optgroup>
            <optgroup label="â”€â”€ AmÃ©rica del Sur â”€â”€">
              <option value="+54">ğŸ‡¦ğŸ‡· +54 Argentina</option>
              <option value="+55">ğŸ‡§ğŸ‡· +55 Brasil</option>
              <option value="+56">ğŸ‡¨ğŸ‡± +56 Chile</option>
              <option value="+57">ğŸ‡¨ğŸ‡´ +57 Colombia</option>
              <option value="+51">ğŸ‡µğŸ‡ª +51 PerÃº</option>
              <option value="+58">ğŸ‡»ğŸ‡ª +58 Venezuela</option>
            </optgroup>
            <optgroup label="â”€â”€ Europa â”€â”€">
              <option value="+49">ğŸ‡©ğŸ‡ª +49 Alemania</option>
              <option value="+34">ğŸ‡ªğŸ‡¸ +34 EspaÃ±a</option>
              <option value="+33">ğŸ‡«ğŸ‡· +33 Francia</option>
              <option value="+39">ğŸ‡®ğŸ‡¹ +39 Italia</option>
              <option value="+351">ğŸ‡µğŸ‡¹ +351 Portugal</option>
              <option value="+44">ğŸ‡¬ğŸ‡§ +44 Reino Unido</option>
            </optgroup>
          </select>
          <input type="tel" id="tel" name="TelÃ©fono" class="phone-inp" placeholder="55 1234 5678" required>
        </div>
      </div>
      <div class="field">
        <label for="email">Correo ElectrÃ³nico <span class="req">*</span></label>
        <input type="email" id="email" name="Correo ElectrÃ³nico" placeholder="correo@ejemplo.com" required>
      </div>
    </div>
  </div>

  <!-- â”€â”€ DATOS DEL VEHÃCULO â”€â”€ -->
  <div class="card">
    <div class="sec-title"><div class="sec-icon">ğŸš—</div> Datos del VehÃ­culo</div>
    <div class="g2">
      <div class="field">
        <label for="cond">CondiciÃ³n del VehÃ­culo <span class="req">*</span></label>
        <select id="cond" name="CondiciÃ³n del VehÃ­culo" required>
          <option value="">Seleccionaâ€¦</option>
          <option>Nuevo</option>
          <option>Seminuevo</option>
        </select>
      </div>
      <div class="field">
        <label for="brandSearch">Marca <span class="req">*</span></label>
        <div class="brand-wrap">
          <input type="text" id="brandSearch" class="up" placeholder="Buscar marcaâ€¦" autocomplete="off">
          <input type="hidden" id="brandVal" name="Marca del VehÃ­culo" required>
          <div class="brand-drop" id="brandDrop"></div>
        </div>
      </div>
      <div class="field otra-wrap" id="otraWrap">
        <label for="otraMarca">Especifica la Marca <span class="req">*</span></label>
        <input type="text" id="otraMarca" name="Otra Marca" class="up" placeholder="Nombre de la marca">
      </div>
      <div class="field">
        <label for="ver">VersiÃ³n / Trim <span class="req">*</span></label>
        <input type="text" id="ver" name="VersiÃ³n" class="up" placeholder="Ej. XSE, Sport, Limitedâ€¦" required>
      </div>
      <div class="field">
        <label for="anio">AÃ±o Modelo <span class="req">*</span></label>
        <select id="anio" name="AÃ±o Modelo" required>
          <option value="">Seleccionaâ€¦</option>
        </select>
      </div>
      <div class="field">
        <label for="niv">NÃºmero de Serie (NIV) <span class="req">*</span></label>
        <input type="text" id="niv" name="NÃºmero de Serie" class="up" placeholder="17 CARACTERES (VIN/NIV)" maxlength="17" required>
      </div>
      <div class="field">
        <label for="motor">NÃºmero de Motor <span class="opt">(opcional)</span></label>
        <input type="text" id="motor" name="NÃºmero de Motor" class="up" placeholder="NÃšMERO DE MOTOR">
      </div>
      <div class="field">
        <label for="clave">Clave Vehicular <span class="opt">(opcional)</span></label>
        <input type="text" id="clave" name="Clave Vehicular" class="up" placeholder="Clave vehicular oficial">
      </div>
    </div>

    <!-- DOCUMENTOS -->
    <div style="margin-top:36px">
      <div class="sec-title" style="margin-bottom:20px"><div class="sec-icon">ğŸ“</div> Cargar DocumentaciÃ³n</div>

      <div class="docs-block">
        <div class="docs-head">
          <div class="docs-head-ico">ğŸ“‹</div>
          <span class="docs-head-txt">Documentos Requeridos</span>
        </div>
        <div class="req-body">
          <div class="req-item"><div class="req-item-ico">ğŸ§¾</div><span><strong>Factura de origen</strong> del vehÃ­culo</span></div>
          <div class="req-item"><div class="req-item-ico">ğŸªª</div><span><strong>IdentificaciÃ³n oficial</strong> â€” INE, Pasaporte o FM2</span></div>
        </div>
      </div>

      <div class="fmt-box">
        <div class="fmt-title">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
          Requisitos de Formato
        </div>
        <div class="fmt-body">
          Sube tus documentos en <strong>PDF, JPG o PNG</strong>. El formulario los comprime automÃ¡ticamente en ZIP.<br>
          Si el ZIP final supera los <strong>5 MB</strong>, el envÃ­o no serÃ¡ permitido â€” en ese caso comprÃ­melos tÃº mismo y envÃ­alos a <a href="mailto:info@anpai.com.mx" class="fmt-link">info@anpai.com.mx</a>.
        </div>
      </div>

      <div class="auth-note">
        <div class="auth-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
          <strong>Requisito de autenticidad.</strong> Los documentos deben ser copia fiel del original.
        </div>
        <div class="legible-grid">
          <div class="legible-ok"><div class="l-ico">âœ“</div><div><div class="l-ttl">LEGIBLE</div>Foto nÃ­tida, bien iluminada, encuadre completo. Sin sombras ni reflejos que cubran datos.</div></div>
          <div class="legible-no"><div class="l-ico">âœ•</div><div><div class="l-ttl">NO LEGIBLE</div>Imagen borrosa, oscura, con dedos tapando datos, o recortada. No puede procesarse.</div></div>
        </div>
      </div>

      <!-- ZONA DE CARGA -->
      <div style="margin-top:18px">
        <label style="display:block;margin-bottom:10px;font-size:.86rem;font-weight:600;color:var(--navy)">
          Adjuntar Documentos <span class="req">*</span>
        </label>

        <div class="attach-dropzone" id="attachDropzoneAVA"
             ondragover="onDragOver(event,'AVA')"
             ondragleave="onDragLeave(event,'AVA')"
             ondrop="onDrop(event,'AVA')"
             onclick="document.getElementById('fileInputAVA').click()">
          <span class="attach-folder-icon">ğŸ“</span>
          <div class="attach-dropzone-text">
            Arrastra tus archivos aquÃ­ o
            <a onclick="event.stopPropagation();document.getElementById('fileInputAVA').click()">haz clic para seleccionarlos</a>
          </div>
          <div class="attach-formats-line">Formatos: <strong>PDF, JPG, PNG</strong></div>
          <div class="attach-auto-compress-line">âœ¨ CompresiÃ³n automÃ¡tica ZIP incluida</div>
          <div class="attach-limit-line">ğŸ“ LÃ­mite total comprimido: <strong>5 MB</strong></div>
          <div class="attach-realtime-stats" id="attachRealtimeAVA" style="display:none">
            <span>ğŸ“¦ <strong id="attachCountAVA">0</strong> archivo(s)</span>
            <span class="attach-stats-sep">|</span>
            <span>ZIP: <strong id="attachWeightAVA">â€”</strong></span>
          </div>
          <div class="attach-limit-exceeded" id="attachLimitExcAVA" style="display:none">Â¡LÃ­mite de 5 MB superado!</div>
          <input type="file" id="fileInputAVA" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="handleFiles(this.files,'AVA');this.value='';">
        </div>

        <div class="attach-capacity-wrap" id="capacityWrapAVA">
          <div class="attach-capacity-header">
            <span class="attach-capacity-label">Capacidad utilizada (ZIP)</span>
            <span class="attach-capacity-value" id="capacityValueAVA">â€” de 5 MB</span>
          </div>
          <div class="attach-bar-track">
            <div class="attach-bar-fill green" id="attachBarAVA" style="width:0%"></div>
          </div>
          <div class="attach-status" id="attachStatusAVA">
            <span class="attach-status-dot green" id="attachDotAVA"></span>
            <span id="attachStatusTextAVA">En espera de archivosâ€¦</span>
          </div>
          <div class="attach-error-msg" id="attachErrAVA">
            <span>âš ï¸</span>
            <span id="attachErrTextAVA">El ZIP supera el lÃ­mite de 5 MB.</span>
          </div>
        </div>

        <div class="compress-progress" id="compressProgressAVA">
          <div class="compress-header">
            <span style="font-size:16px">âš¡</span>
            <span class="compress-header-text">Comprimiendoâ€¦</span>
            <span id="compressPctAVA" class="compress-pct">0%</span>
          </div>
          <div class="compress-body">
            <div class="compress-row">
              <div class="compress-stat"><div class="compress-stat-val" id="compressDoneMBAVA">0 B</div><div class="compress-stat-label">Comprimido</div></div>
              <div class="compress-stat"><div class="compress-stat-val" id="compressRemMBAVA">0 B</div><div class="compress-stat-label">Restante</div></div>
              <div class="compress-stat"><div class="compress-stat-val" id="compressElapsedAVA">0s</div><div class="compress-stat-label">Transcurrido</div></div>
              <div class="compress-stat"><div class="compress-stat-val" id="compressEtaAVA">â€”</div><div class="compress-stat-label">Estimado</div></div>
            </div>
            <div class="compress-bar-track"><div class="compress-bar-fill" id="compressBarFillAVA"></div></div>
            <div class="compress-info">
              <span id="compressInfoAVA">Preparandoâ€¦</span>
              <span id="compressDonePctAVA">0% completado</span>
            </div>
            <div class="compress-resume-note" id="compressResumeAVA">
              <span>ğŸ”„</span><span>Pausado. ContinuarÃ¡ cuando vuelva la conexiÃ³n.</span>
            </div>
          </div>
        </div>

        <div class="attach-file-list" id="fileListAVA"></div>

        <div class="offline-msg" id="offlineMsgAVA">
          <span>ğŸ“¡</span><span>Sin conexiÃ³n. La compresiÃ³n se reanudarÃ¡ automÃ¡ticamente.</span>
        </div>

        <input type="hidden" id="attachHiddenAVA" name="Archivos_adjuntos_info">
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         NUEVO RESUMEN DE SOLICITUD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="sumbox" id="sumbox">

      <!-- Encabezado con badge de estado dinÃ¡mico -->
      <div class="sum-hd">
        <div class="sum-hd-left">
          <div class="sum-hd-icon">
            <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
          </div>
          <div>
            <div class="sum-ttl">Resumen de Solicitud</div>
            <div class="sum-sub">Revisa tus datos antes de enviar</div>
          </div>
        </div>
        <div class="sum-badge pending" id="sum-badge">
          <span class="badge-dot"></span>
          <span id="sum-badge-txt">Pendiente</span>
        </div>
      </div>

      <!-- Cuerpo del resumen (grupos generados dinÃ¡micamente) -->
      <div id="sum-body">

        <!-- Grupo: Datos Personales -->
        <div class="sum-grp">
          <div class="sum-grp-lbl">
            <span class="sum-grp-lbl-ico">ğŸ‘¤</span>
            <span class="sum-grp-lbl-txt">Datos Personales</span>
          </div>
          <div class="sum-row" id="row-nombre">
            <span class="sum-k">Nombre completo</span>
            <span class="sum-v empty" id="val-nombre">â€”</span>
          </div>
          <div class="sum-row" id="row-genero">
            <span class="sum-k">GÃ©nero</span>
            <span class="sum-v empty" id="val-genero">â€”</span>
          </div>
          <div class="sum-row" id="row-fecha">
            <span class="sum-k">Fecha de nacimiento</span>
            <span class="sum-v empty" id="val-fecha">â€”</span>
          </div>
          <div class="sum-row" id="row-rfc">
            <span class="sum-k">RFC</span>
            <span class="sum-v empty" id="val-rfc">â€”</span>
          </div>
          <div class="sum-row" id="row-curp">
            <span class="sum-k">CURP</span>
            <span class="sum-v empty" id="val-curp">â€”</span>
          </div>
        </div>

        <!-- Grupo: Contacto y Domicilio -->
        <div class="sum-grp">
          <div class="sum-grp-lbl">
            <span class="sum-grp-lbl-ico">ğŸ“</span>
            <span class="sum-grp-lbl-txt">Contacto y Domicilio</span>
          </div>
          <div class="sum-row" id="row-tel">
            <span class="sum-k">TelÃ©fono</span>
            <span class="sum-v empty" id="val-tel">â€”</span>
          </div>
          <div class="sum-row" id="row-email">
            <span class="sum-k">Correo electrÃ³nico</span>
            <span class="sum-v empty" id="val-email">â€”</span>
          </div>
          <div class="sum-row" id="row-cp">
            <span class="sum-k">C.P. / Municipio</span>
            <span class="sum-v empty" id="val-cp">â€”</span>
          </div>
          <div class="sum-row" id="row-colonia">
            <span class="sum-k">Colonia / Estado</span>
            <span class="sum-v empty" id="val-colonia">â€”</span>
          </div>
        </div>

        <!-- Grupo: VehÃ­culo -->
        <div class="sum-grp">
          <div class="sum-grp-lbl">
            <span class="sum-grp-lbl-ico">ğŸš—</span>
            <span class="sum-grp-lbl-txt">VehÃ­culo</span>
          </div>
          <div class="sum-row" id="row-tipo">
            <span class="sum-k">CondiciÃ³n</span>
            <span class="sum-v empty" id="val-tipo">â€”</span>
          </div>
          <div class="sum-row" id="row-marca">
            <span class="sum-k">Marca</span>
            <span class="sum-v empty" id="val-marca">â€”</span>
          </div>
          <div class="sum-row" id="row-anio">
            <span class="sum-k">AÃ±o / VersiÃ³n</span>
            <span class="sum-v empty" id="val-anio">â€”</span>
          </div>
          <div class="sum-row" id="row-vin">
            <span class="sum-k">NÃºm. de Serie (NIV)</span>
            <span class="sum-v empty" id="val-vin">â€”</span>
          </div>
        </div>

        <!-- Grupo: Documentos -->
        <div class="sum-grp">
          <div class="sum-grp-lbl">
            <span class="sum-grp-lbl-ico">ğŸ“</span>
            <span class="sum-grp-lbl-txt">Documentos</span>
          </div>
          <div class="sum-row" id="row-archivos">
            <span class="sum-k">Archivos adjuntos</span>
            <span class="sum-v empty" id="val-archivos">â€”</span>
          </div>
        </div>

      </div>
      <!-- /sum-body -->

      <!-- Footer informativo -->
      <div class="sum-footer">
        <span style="font-size:16px">â„¹ï¸</span>
        <p class="sum-footer-txt">
          <strong>Verifica la informaciÃ³n antes de enviar.</strong>
          Si detectas algÃºn error, corrige el campo correspondiente.
        </p>
      </div>

    </div>
    <!-- /sumbox -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DECLARACIÃ“N
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <label class="decl-wrap" for="declCheck">
      <input type="checkbox" id="declCheck">
      <span class="decl-text">
        <span class="decl-title">DeclaraciÃ³n de veracidad y autenticidad</span>
        Bajo protesta de decir verdad, declaro que toda la informaciÃ³n y documentaciÃ³n proporcionada es autÃ©ntica.
        <strong>Al marcar esta casilla, manifiesto mi conformidad otorgando a esta acciÃ³n el mismo valor jurÃ­dico
        que mi firma autÃ³grafa, de conformidad con el artÃ­culo 89 del CÃ³digo de Comercio y la NOM-151-SCFI-2016.</strong>
      </span>
    </label>

    <button type="submit" class="btn-sub" id="btnSub" disabled>ğŸ›¡ï¸ &nbsp;Enviar CotizaciÃ³n de Seguro</button>
    <p class="btn-note">Tus datos estÃ¡n protegidos con cifrado SSL y verificaciÃ³n reCAPTCHA v3.</p>
    <p class="rc-note">
      Protegido por reCAPTCHA â€”
      <a href="https://policies.google.com/privacy" target="_blank">Privacidad</a> Â·
      <a href="https://policies.google.com/terms" target="_blank">TÃ©rminos</a>
    </p>
  </div>
</form>
</div>

<!-- PROGRESS BAR -->
<div class="prog-wrap" id="progWrap">
  <div class="prog-pill">
    <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
    <span class="prog-txt"><strong id="progDone">0</strong> de <span id="progTotal">0</span> campos completados</span>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="modal-ov" id="modal">
  <div class="modal-box">
    <div class="modal-check">
      <svg viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="white" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
    <h2 class="modal-title">Â¡Recibimos tu solicitud!</h2>
    <div class="modal-bar"></div>
    <p class="modal-body">
      Muchas gracias por elegirnos. Uno de nuestros asesores revisarÃ¡ tu informaciÃ³n y te contactarÃ¡
      <strong>a la brevedad posible</strong> por correo o telÃ©fono. Â¡Estamos para servirte! ğŸ›¡ï¸ğŸš—
    </p>
    <div class="modal-tag">â±ï¸ Tiempo de respuesta: menos de 24 horas hÃ¡biles</div>
    <button class="modal-btn" onclick="closeModal()">Â¡Entendido, gracias!</button>
  </div>
</div>

<!-- WHATSAPP FLOAT -->
<a href="https://wa.me/525525374608?text=Hola%20ANPAI%2C%20tengo%20una%20consulta" class="wa-float" target="_blank" aria-label="WhatsApp">
  <span class="wa-tip">ğŸ’¬ Â¿Dudas? Chatea con nosotros</span>
  <svg width="34" height="34" viewBox="0 0 24 24" fill="white">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.67-1.612-.92-2.207-.24-.579-.487-.5-.67-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.9 6.994c-.004 5.45-4.436 9.88-9.885 9.88m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
  </svg>
</a>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var SITE_KEY   = '6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';
var CP_TOKEN   = '36da398a-1848-44f3-a952-06c9bfb02cc8';
var MAX_BYTES  = 5 * 1024 * 1024;
var OK_EXTS    = ['pdf','jpg','jpeg','png'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DARK MODE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function() {
  try { if (localStorage.getItem('ava-theme') === 'dark') document.body.classList.add('dark'); } catch(e) {}
  document.getElementById('themeBtn').addEventListener('click', function() {
    var d = document.body.classList.toggle('dark');
    try { localStorage.setItem('ava-theme', d ? 'dark' : 'light'); } catch(e) {}
  });
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   YEAR DROPDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function() {
  var sel = document.getElementById('anio');
  var yr  = new Date().getFullYear();
  for (var y = yr + 1; y >= 1990; y--) {
    var o = document.createElement('option');
    o.value = o.textContent = y;
    sel.appendChild(o);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPPERCASE INPUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.querySelectorAll('input.up').forEach(function(el) {
  el.addEventListener('input', function() {
    var s = this.selectionStart, e = this.selectionEnd;
    this.value = this.value.toUpperCase();
    try { this.setSelectionRange(s, e); } catch(_) {}
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RFC & CURP VALIDATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var RFC_RE  = /^([A-ZÃ‘&]{3,4})(\d{6})([A-Z0-9]{3})$/;
var CURP_RE = /^[A-Z]{1}[AEIOU]{1}[A-Z]{2}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[HM]{1}(AS|BC|BS|CC|CL|CM|CS|CH|DF|DG|GT|GR|HG|JC|MC|MN|MS|NT|NL|OC|PL|QT|QR|SP|SL|SR|TC|TS|TL|VZ|YN|ZS|NE)[B-DF-HJ-NP-TV-Z]{3}[A-Z0-9]{1}\d{1}$/;

function validateField(id, regex, hintId, minLen, exactLen, name) {
  var el   = document.getElementById(id);
  var hint = document.getElementById(hintId);
  var val  = el.value.trim();
  if (!val) {
    el.classList.remove('field-ok','field-err');
    hint.textContent = ''; hint.className = 'fhint'; return;
  }
  if (regex.test(val)) {
    el.classList.add('field-ok'); el.classList.remove('field-err');
    hint.textContent = 'âœ“ ' + name + ' vÃ¡lido'; hint.className = 'fhint ok';
  } else {
    el.classList.add('field-err'); el.classList.remove('field-ok');
    var len = val.length;
    if (len < minLen) hint.textContent = 'Faltan ' + (minLen - len) + ' caracteres (mÃ­n. ' + minLen + ')';
    else if (exactLen && len > exactLen) hint.textContent = 'MÃ¡ximo ' + exactLen + ' caracteres';
    else hint.textContent = 'Formato incorrecto';
    hint.className = 'fhint err';
  }
  buildSummary();
}

document.getElementById('rfc').addEventListener('input', function() {
  validateField('rfc', RFC_RE, 'rfcHint', 12, 13, 'RFC');
});
document.getElementById('curp').addEventListener('input', function() {
  validateField('curp', CURP_RE, 'curpHint', 18, 18, 'CURP');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTOFILL HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setAF(id, hintId, value) {
  var el = document.getElementById(id);
  var h  = document.getElementById(hintId);
  if (value) {
    el.value = value;
    el.classList.remove('uw'); el.classList.add('uf');
    h.classList.add('ready');
    h.innerHTML = '<span class="af-dot"></span> Autocompletado desde tu CP âœ“';
  } else {
    el.value = '';
    el.classList.remove('uf'); el.classList.add('uw');
    h.classList.remove('ready');
    h.innerHTML = '<span class="af-dot"></span> Esperando cÃ³digo postalâ€¦';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CÃ“DIGO POSTAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('cp').addEventListener('input', function() {
  var val = this.value.replace(/\D/g,'');
  this.value = val;
  var load = document.getElementById('cpLoad');
  var err  = document.getElementById('cpErr');
  var box  = document.getElementById('cpBox');
  var cw   = document.getElementById('colWrap');
  var cs   = document.getElementById('colSel');
  var cb   = document.getElementById('colBadge');

  load.className = 'cp-load';
  err.className  = 'cp-err';
  box.className  = 'cp-box';
  cw.className   = 'col-wrap';

  if (val.length !== 5) {
    setAF('estado','estHint',''); setAF('mun','munHint','');
    updateProgress(); buildSummary(); return;
  }

  load.className = 'cp-load on';

  fetch('https://api.copomex.com/query/info_cp/' + val + '?type=simplified&token=' + CP_TOKEN)
    .then(function(r) { return r.json(); })
    .then(function(data) {
      load.className = 'cp-load';
      var obj = Array.isArray(data) ? data[0] : data;
      if (!obj || obj.error || !obj.response) {
        err.textContent = (obj && obj.error_message) || 'CÃ³digo postal no encontrado.';
        err.className = 'cp-err on';
        setAF('estado','estHint',''); setAF('mun','munHint','');
        updateProgress(); buildSummary(); return;
      }
      var info     = obj.response;
      var colonias = Array.isArray(info.asentamiento)
        ? info.asentamiento.slice().sort(function(a,b){ return a.localeCompare(b,'es'); })
        : (info.asentamiento ? [info.asentamiento] : []);

      setAF('estado','estHint', info.estado || '');
      setAF('mun','munHint', info.municipio || '');

      box.innerHTML = '<span class="cp-badge">CP ' + val + '</span><strong>' + (info.municipio||'') + '</strong>, ' + (info.estado||'');
      box.className = 'cp-box on';

      if (colonias.length > 1) {
        cs.innerHTML = '<option value="">Elige tu coloniaâ€¦</option>';
        colonias.forEach(function(c) {
          var o = document.createElement('option');
          o.value = o.textContent = c;
          cs.appendChild(o);
        });
        cb.textContent = colonias.length + ' opciones';
        cw.className = 'col-wrap on';
      } else if (colonias.length === 1) {
        cs.innerHTML = '<option value="' + colonias[0] + '" selected>' + colonias[0] + '</option>';
      }
      updateProgress(); buildSummary();
    })
    .catch(function() {
      load.className = 'cp-load';
      err.textContent = 'No se pudo consultar el cÃ³digo postal. Verifica tu conexiÃ³n.';
      err.className = 'cp-err on';
      setAF('estado','estHint',''); setAF('mun','munHint','');
      updateProgress(); buildSummary();
    });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BRAND SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var BRANDS = {
  'Chinas':          [{f:'ğŸ‡¨ğŸ‡³',n:'BAIC'},{f:'ğŸ‡¨ğŸ‡³',n:'BYD'},{f:'ğŸ‡¨ğŸ‡³',n:'Chery'},{f:'ğŸ‡¨ğŸ‡³',n:'DFSK'},{f:'ğŸ‡¨ğŸ‡³',n:'Foton'},{f:'ğŸ‡¨ğŸ‡³',n:'Geely'},{f:'ğŸ‡¨ğŸ‡³',n:'Great Wall'},{f:'ğŸ‡¨ğŸ‡³',n:'Haval'},{f:'ğŸ‡¨ğŸ‡³',n:'JAC'},{f:'ğŸ‡¨ğŸ‡³',n:'MG'}],
  'Europeas':        [{f:'ğŸ‡®ğŸ‡¹',n:'Alfa Romeo'},{f:'ğŸ‡©ğŸ‡ª',n:'Audi'},{f:'ğŸ‡©ğŸ‡ª',n:'BMW'},{f:'ğŸ‡®ğŸ‡¹',n:'Fiat'},{f:'ğŸ‡¬ğŸ‡§',n:'Jaguar'},{f:'ğŸ‡¬ğŸ‡§',n:'Land Rover'},{f:'ğŸ‡©ğŸ‡ª',n:'Mercedes-Benz'},{f:'ğŸ‡«ğŸ‡·',n:'Peugeot'},{f:'ğŸ‡©ğŸ‡ª',n:'Porsche'},{f:'ğŸ‡«ğŸ‡·',n:'Renault'},{f:'ğŸ‡ªğŸ‡¸',n:'SEAT'},{f:'ğŸ‡©ğŸ‡ª',n:'Volkswagen'},{f:'ğŸ‡¸ğŸ‡ª',n:'Volvo'}],
  'Estadounidenses': [{f:'ğŸ‡ºğŸ‡¸',n:'Buick'},{f:'ğŸ‡ºğŸ‡¸',n:'Cadillac'},{f:'ğŸ‡ºğŸ‡¸',n:'Chevrolet'},{f:'ğŸ‡ºğŸ‡¸',n:'Dodge'},{f:'ğŸ‡ºğŸ‡¸',n:'Ford'},{f:'ğŸ‡ºğŸ‡¸',n:'GMC'},{f:'ğŸ‡ºğŸ‡¸',n:'Jeep'},{f:'ğŸ‡ºğŸ‡¸',n:'Lincoln'},{f:'ğŸ‡ºğŸ‡¸',n:'RAM'},{f:'ğŸ‡ºğŸ‡¸',n:'Tesla'}],
  'Japonesas':       [{f:'ğŸ‡¯ğŸ‡µ',n:'Acura'},{f:'ğŸ‡¯ğŸ‡µ',n:'Honda'},{f:'ğŸ‡¯ğŸ‡µ',n:'Infiniti'},{f:'ğŸ‡¯ğŸ‡µ',n:'Lexus'},{f:'ğŸ‡¯ğŸ‡µ',n:'Mazda'},{f:'ğŸ‡¯ğŸ‡µ',n:'Mitsubishi'},{f:'ğŸ‡¯ğŸ‡µ',n:'Nissan'},{f:'ğŸ‡¯ğŸ‡µ',n:'Subaru'},{f:'ğŸ‡¯ğŸ‡µ',n:'Suzuki'},{f:'ğŸ‡¯ğŸ‡µ',n:'Toyota'}],
  'Coreanas':        [{f:'ğŸ‡°ğŸ‡·',n:'Daewoo'},{f:'ğŸ‡°ğŸ‡·',n:'Genesis'},{f:'ğŸ‡°ğŸ‡·',n:'Hyundai'},{f:'ğŸ‡°ğŸ‡·',n:'Kia'},{f:'ğŸ‡°ğŸ‡·',n:'SsangYong'}],
};

var bSearch = document.getElementById('brandSearch');
var bVal    = document.getElementById('brandVal');
var bDrop   = document.getElementById('brandDrop');
var otraWrap = document.getElementById('otraWrap');
var otraMarca = document.getElementById('otraMarca');

function buildBrandDrop(q) {
  q = (q || '').toLowerCase();
  bDrop.innerHTML = '';
  var found = false;
  Object.keys(BRANDS).forEach(function(cat) {
    var items = BRANDS[cat].filter(function(b) { return b.n.toLowerCase().includes(q); });
    if (!items.length) return;
    found = true;
    var c = document.createElement('div'); c.className = 'brand-cat'; c.textContent = cat;
    bDrop.appendChild(c);
    items.forEach(function(b) {
      var el = document.createElement('div'); el.className = 'brand-item';
      el.innerHTML = '<span class="brand-flag">' + b.f + '</span>' + b.n;
      el.addEventListener('mousedown', function(e) { e.preventDefault(); selectBrand(b.n); });
      bDrop.appendChild(el);
    });
  });
  if (!found || q === '' || 'otra'.includes(q)) {
    var el = document.createElement('div'); el.className = 'brand-item';
    el.innerHTML = '<span class="brand-flag">ğŸ”</span>Otra marcaâ€¦';
    el.addEventListener('mousedown', function(e) { e.preventDefault(); selectBrand('__otra__'); });
    bDrop.appendChild(el);
  }
}

function selectBrand(name) {
  if (name === '__otra__') {
    bSearch.value = 'Otra marcaâ€¦'; bVal.value = '';
    otraWrap.classList.add('on'); otraMarca.required = true;
  } else {
    bSearch.value = name; bVal.value = name;
    otraWrap.classList.remove('on'); otraMarca.required = false;
  }
  bDrop.classList.remove('open');
  updateProgress(); buildSummary();
}

bSearch.addEventListener('focus', function() { buildBrandDrop(this.value); bDrop.classList.add('open'); });
bSearch.addEventListener('input', function() { buildBrandDrop(this.value); bDrop.classList.add('open'); updateProgress(); buildSummary(); });
bSearch.addEventListener('blur',  function() { setTimeout(function() { bDrop.classList.remove('open'); }, 160); });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILE UPLOAD (JSZip)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var MAX_ZIP_BYTES = 5 * 1024 * 1024;

var attachState = {
  'AVA': { files:[], zipBlob:null, compressing:false, paused:false, startTime:null, elapsed:0, _runId:null }
};

function fmtBytes(b){
  if(b<1024) return b+' B';
  if(b<1048576) return (b/1024).toFixed(1)+' KB';
  return (b/1048576).toFixed(2)+' MB';
}
function fmtSec(s){ return s<60 ? Math.round(s)+'s' : Math.floor(s/60)+'m '+Math.round(s%60)+'s'; }
function getFileIcon(name){
  var ext=name.split('.').pop().toLowerCase();
  if(['jpg','jpeg','png'].indexOf(ext)>=0) return 'ğŸ–¼ï¸';
  if(ext==='pdf') return 'ğŸ“„';
  return 'ğŸ“';
}
function getToday(){
  var d=new Date();
  return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0');
}

function onDragOver(e,type){ e.preventDefault(); document.getElementById('attachDropzone'+type).classList.add('drag-over'); }
function onDragLeave(e,type){ document.getElementById('attachDropzone'+type).classList.remove('drag-over'); }
function onDrop(e,type){ e.preventDefault(); document.getElementById('attachDropzone'+type).classList.remove('drag-over'); handleFiles(e.dataTransfer.files,type); }

function handleFiles(fileList,type){
  var state=attachState[type];
  Array.from(fileList).forEach(function(f){
    var dup=state.files.some(function(ex){ return ex.name===f.name&&ex.size===f.size; });
    if(!dup) state.files.push(f);
  });
  state.zipBlob=null;
  renderFileList(type);
  updateCapacityBar(type);
  if(state.files.length>=1&&typeof JSZip!=='undefined') scheduleCompression(type);
  updateProgress(); buildSummary();
}

window.removeFile=function(type,idx){
  var state=attachState[type];
  state.files.splice(idx,1);
  state.zipBlob=null;
  renderFileList(type);
  hideAttachMsg(type);
  updateCapacityBar(type);
  if(state.files.length>=1&&typeof JSZip!=='undefined') scheduleCompression(type);
  else if(state.files.length===0){
    updateCapacityBar(type);
    document.getElementById('compressProgress'+type).classList.remove('show');
  }
  updateProgress(); buildSummary();
};

function renderFileList(type){
  var list=document.getElementById('fileList'+type);
  list.innerHTML='';
  attachState[type].files.forEach(function(f,i){
    var item=document.createElement('div');
    item.className='attach-file-item';
    item.innerHTML=
      '<span class="attach-file-icon">'+getFileIcon(f.name)+'</span>'+
      '<span class="attach-file-name" title="'+f.name+'">'+f.name+'</span>'+
      '<span class="attach-file-size">'+fmtBytes(f.size)+'</span>'+
      '<button type="button" class="attach-file-remove" onclick="removeFile(\''+type+'\','+i+')">\u00d7</button>';
    list.appendChild(item);
  });
}

function updateCapacityBar(type){
  var state=attachState[type];
  var wrap=document.getElementById('capacityWrap'+type);
  var bar=document.getElementById('attachBar'+type);
  var valEl=document.getElementById('capacityValue'+type);
  var dot=document.getElementById('attachDot'+type);
  var statusTxt=document.getElementById('attachStatusText'+type);
  var rtStats=document.getElementById('attachRealtime'+type);
  var rtCount=document.getElementById('attachCount'+type);
  var rtWeight=document.getElementById('attachWeight'+type);
  var limitExc=document.getElementById('attachLimitExc'+type);

  if(state.files.length===0){
    wrap.classList.remove('visible');
    if(rtStats) rtStats.style.display='none';
    if(limitExc) limitExc.style.display='none';
    bar.className='attach-bar-fill green';
    bar.style.width='0%';
    return;
  }
  wrap.classList.add('visible');
  if(rtStats) rtStats.style.display='flex';
  if(rtCount) rtCount.textContent=state.files.length;

  if(!state.zipBlob){
    bar.className='attach-bar-fill green';
    bar.style.width='0%';
    dot.className='attach-status-dot green';
    statusTxt.textContent=state.compressing?'Comprimiendo archivosâ€¦':'En espera de compresiÃ³nâ€¦';
    valEl.textContent='â€” de 5 MB (ZIP pendiente)';
    if(rtWeight) rtWeight.textContent='â€”';
    if(limitExc) limitExc.style.display='none';
    return;
  }

  var zSize=state.zipBlob.size;
  var pct=Math.min(100,(zSize/MAX_ZIP_BYTES)*100);
  var zStr=fmtBytes(zSize);
  bar.style.width=pct+'%';
  valEl.textContent=zStr+' de 5 MB (ZIP comprimido)';
  if(rtWeight) rtWeight.textContent=zStr;
  bar.className='attach-bar-fill';
  dot.className='attach-status-dot';

  if(zSize>=MAX_ZIP_BYTES){
    bar.classList.add('red'); dot.classList.add('red');
    statusTxt.textContent='ZIP supera 5 MB â€” elimina archivos';
    showAttachMsg(type,'El ZIP pesa '+zStr+' y supera el lÃ­mite. Elimina archivos.');
    if(limitExc) limitExc.style.display='block';
  } else if(zSize>=MAX_ZIP_BYTES*0.80){
    bar.classList.add('yellow'); dot.classList.add('yellow');
    statusTxt.textContent='Casi lleno â€” quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' en el ZIP';
    hideAttachMsg(type);
    if(limitExc) limitExc.style.display='none';
  } else {
    bar.classList.add('green'); dot.classList.add('green');
    statusTxt.textContent='ZIP listo â€” quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' disponibles';
    hideAttachMsg(type);
    if(limitExc) limitExc.style.display='none';
  }
}

function showAttachMsg(type,msg){
  var el=document.getElementById('attachErr'+type);
  var tx=document.getElementById('attachErrText'+type);
  if(tx) tx.textContent=msg;
  if(el) el.classList.add('show');
}
function hideAttachMsg(type){
  var el=document.getElementById('attachErr'+type);
  if(el) el.classList.remove('show');
}

window.addEventListener('online',function(){
  Object.keys(attachState).forEach(function(type){
    var state=attachState[type];
    var om=document.getElementById('offlineMsg'+type);
    if(om) om.classList.remove('show');
    if(state.paused&&state.files.length>=1){ state.paused=false; startCompression(type); }
  });
});
window.addEventListener('offline',function(){
  Object.keys(attachState).forEach(function(type){
    var state=attachState[type];
    var om=document.getElementById('offlineMsg'+type);
    if(om) om.classList.add('show');
    if(state.compressing){
      state.paused=true; state.compressing=false;
      state.elapsed=Date.now()-state.startTime;
      var cr=document.getElementById('compressResume'+type);
      if(cr) cr.classList.add('show');
    }
  });
});

var compressionTimers={};
function scheduleCompression(type){
  clearTimeout(compressionTimers[type]);
  compressionTimers[type]=setTimeout(function(){ startCompression(type); },80);
}

function startCompression(type){
  var state=attachState[type];
  if(state.compressing){ state.compressing=false; }
  if(state.files.length===0) return;

  if(!navigator.onLine){
    var om=document.getElementById('offlineMsg'+type);
    if(om) om.classList.add('show');
    state.paused=true;
    var cr=document.getElementById('compressResume'+type);
    if(cr) cr.classList.add('show');
    var cp=document.getElementById('compressProgress'+type);
    if(cp) cp.classList.add('show');
    return;
  }

  var snapshot=state.files.slice();
  var runId=Date.now();
  var zip=new JSZip();
  var totalRaw=snapshot.reduce(function(a,f){ return a+f.size; },0);
  var processed=0;

  state.compressing=true;
  state.paused=false;
  state.startTime=Date.now();
  state.elapsed=0;
  state._runId=runId;

  var cp=document.getElementById('compressProgress'+type);
  if(cp) cp.classList.add('show');
  updateCapacityBar(type);

  var ticker=setInterval(function(){
    if(!state.compressing||state._runId!==runId){ clearInterval(ticker); return; }
    state.elapsed=Date.now()-state.startTime;
    var el=document.getElementById('compressElapsed'+type);
    if(el) el.textContent=fmtSec(state.elapsed/1000);
  },300);

  function abort(){
    clearInterval(ticker);
    state.compressing=false;
    var cp2=document.getElementById('compressProgress'+type);
    if(cp2) cp2.classList.remove('show');
  }

  function processFile(idx){
    if(state._runId!==runId||!state.compressing){ abort(); return; }
    if(idx>=snapshot.length){
      var ci=document.getElementById('compressInfo'+type);
      if(ci) ci.textContent='Generando ZIPâ€¦';
      zip.generateAsync(
        {type:'blob',compression:'DEFLATE',compressionOptions:{level:6}},
        function(meta){
          if(state._runId!==runId) return;
          updateCompressUI(type,Math.round(meta.percent),processed,0,(Date.now()-state.startTime)/1000,totalRaw);
        }
      ).then(function(blob){
        clearInterval(ticker);
        if(state._runId!==runId){ abort(); return; }
        state.compressing=false;
        state.zipBlob=blob;
        var cp3=document.getElementById('compressProgress'+type);
        if(cp3) cp3.classList.remove('show');
        updateCapacityBar(type);
        var h=document.getElementById('attachHidden'+type);
        if(h) h.value='ZIP: archivos-'+getToday()+'.zip ('+fmtBytes(blob.size)+')';
        updateProgress(); buildSummary();
      }).catch(function(){
        abort();
        showAttachMsg(type,'Error al comprimir. Intenta de nuevo.');
      });
      return;
    }

    var f=snapshot[idx];
    var reader=new FileReader();
    reader.onload=function(ev){
      if(state._runId!==runId){ abort(); return; }
      zip.file(f.name,ev.target.result);
      processed+=f.size;
      var pct=Math.round((processed/totalRaw)*70);
      updateCompressUI(type,pct,processed,totalRaw-processed,(Date.now()-state.startTime)/1000,totalRaw);
      if(!navigator.onLine){
        clearInterval(ticker);
        state.paused=true; state.compressing=false;
        var om2=document.getElementById('offlineMsg'+type);
        if(om2) om2.classList.add('show');
        var cr2=document.getElementById('compressResume'+type);
        if(cr2) cr2.classList.add('show');
        return;
      }
      setTimeout(function(){ processFile(idx+1); },0);
    };
    reader.onerror=function(){ setTimeout(function(){ processFile(idx+1); },0); };
    reader.readAsArrayBuffer(f);
  }
  processFile(0);
}

function updateCompressUI(type,pct,done,remaining,elapsedSec,total){
  var ids={pct:'compressPct',bar:'compressBarFill',done:'compressDoneMB',rem:'compressRemMB',donePct:'compressDonePct',elapsed:'compressElapsed',eta:'compressEta',info:'compressInfo'};
  Object.keys(ids).forEach(function(k){
    var el=document.getElementById(ids[k]+type); if(!el) return;
    if(k==='pct')     el.textContent=pct+'%';
    if(k==='bar')     el.style.width=pct+'%';
    if(k==='done')    el.textContent=fmtBytes(done);
    if(k==='rem')     el.textContent=fmtBytes(remaining);
    if(k==='donePct') el.textContent=pct+'% completado';
    if(k==='elapsed') el.textContent=fmtSec(elapsedSec);
    if(k==='eta')     el.textContent=(pct>5&&elapsedSec>0)?fmtSec((elapsedSec/pct)*(100-pct)):'â€”';
    if(k==='info')    el.textContent='Procesando '+attachState[type].files.length+' archivo(s)â€¦';
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUMMARY â€” nuevo sistema con updateRow / updateRowChip / setBadgeState
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Actualiza el badge de estado del resumen */
function setBadgeState(state) {
  var badge    = document.getElementById('sum-badge');
  var badgeTxt = document.getElementById('sum-badge-txt');
  if (!badge || !badgeTxt) return;
  badge.classList.remove('pending','warn','ok');
  badge.classList.add(state);
  var labels = { pending:'Pendiente', warn:'Incompleto', ok:'Listo' };
  badgeTxt.textContent = labels[state] || state;
}

/* Actualiza el texto de un valor en el resumen con animaciÃ³n de flash */
function updateRow(id, value) {
  var el = document.getElementById('val-' + id);
  if (!el) return;
  var empty = !value || !String(value).trim();
  el.textContent = empty ? 'â€”' : String(value);
  el.className   = 'sum-v' + (empty ? ' empty' : '');
  var row = el.closest('.sum-row');
  if (row && !empty) {
    row.classList.remove('row-updated');
    void row.offsetWidth;
    row.classList.add('row-updated');
  }
}

/* Actualiza un valor con chip de color */
function updateRowChip(id, value, chipClass) {
  var container = document.getElementById('val-' + id);
  if (!container) return;
  var empty  = !value || !String(value).trim();
  var parent = container.parentNode;
  var newEl  = document.createElement('span');
  newEl.id   = 'val-' + id;
  if (empty) {
    newEl.className   = 'sum-v empty';
    newEl.textContent = 'â€”';
  } else {
    newEl.className   = 'sum-chip' + (chipClass ? ' ' + chipClass : '');
    newEl.textContent = value;
  }
  parent.replaceChild(newEl, container);
  var row = newEl.closest('.sum-row');
  if (row && !empty) {
    row.classList.remove('row-updated');
    void row.offsetWidth;
    row.classList.add('row-updated');
  }
}

function gv(id) { var e=document.getElementById(id); return e?e.value.trim():''; }

function buildSummary() {
  /* â”€â”€ Datos Personales â”€â”€ */
  var nombre = [gv('fn'),gv('sn'),gv('fa'),gv('sa')].filter(Boolean).join(' ').trim();
  updateRow('nombre', nombre);
  updateRow('genero', gv('gen'));
  updateRow('fecha',  gv('dob'));
  updateRow('rfc',    gv('rfc'));
  updateRow('curp',   gv('curp'));

  /* â”€â”€ Contacto y Domicilio â”€â”€ */
  updateRow('tel',   gv('tel'));
  updateRow('email', gv('email'));
  var cpMun = gv('cp') && gv('mun') ? 'CP ' + gv('cp') + ' â€” ' + gv('mun') : (gv('cp') || '');
  updateRow('cp',      cpMun);
  var coloniaEst = gv('colSel') && gv('estado') ? gv('colSel') + ' / ' + gv('estado') : (gv('estado') || gv('colSel') || '');
  updateRow('colonia', coloniaEst);

  /* â”€â”€ VehÃ­culo â”€â”€ */
  updateRowChip('tipo',  gv('cond'), '');
  var marca = bVal.value || '';
  if (!marca && otraWrap.classList.contains('on')) marca = 'Otra (' + gv('otraMarca') + ')';
  updateRowChip('marca', marca, '');
  var anioVer = gv('anio') && gv('ver') ? gv('anio') + ' â€” ' + gv('ver') : (gv('anio') || gv('ver') || '');
  updateRow('anio', anioVer);
  updateRow('vin',  gv('niv'));

  /* â”€â”€ Documentos â”€â”€ */
  var nf = attachState['AVA'].files.length;
  var zipInfo = attachState['AVA'].zipBlob ? ' â€” ZIP: ' + fmtBytes(attachState['AVA'].zipBlob.size) : '';
  updateRowChip('archivos', nf ? nf + ' archivo(s)' + zipInfo : '', 'files');

  /* â”€â”€ Badge de estado â”€â”€ */
  var requiredFilled = [nombre, gv('gen'), gv('dob'), gv('rfc'), gv('curp'), gv('tel'), gv('email'),
                        gv('cp'), gv('estado'), gv('cond'), marca, gv('ver'), gv('anio'), gv('niv')];
  var allFilled = requiredFilled.every(function(v){ return v && v.trim(); });

  if (allFilled) {
    setBadgeState('ok');
  } else if (requiredFilled.some(function(v){ return v && v.trim(); })) {
    setBadgeState('warn');
  } else {
    setBadgeState('pending');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var REQUIRED_IDS = ['fn','fa','sa','gen','dob','rfc','curp','cp','tel','email','cond','ver','anio','niv'];

function isFilledById(id) {
  if (id === 'estado' || id === 'mun') {
    var el = document.getElementById(id);
    return el && el.classList.contains('uf');
  }
  var el = document.getElementById(id);
  return el && el.value.trim().length > 0;
}

function updateProgress() {
  var ids   = REQUIRED_IDS.concat(['estado','mun']);
  var total = ids.length + 1;
  var done  = 0;
  ids.forEach(function(id) { if (isFilledById(id)) done++; });
  if (bVal.value.trim()) done++;
  var pct = total > 0 ? (done/total)*100 : 0;
  document.getElementById('progFill').style.width = pct + '%';
  document.getElementById('progDone').textContent  = done;
  document.getElementById('progTotal').textContent = total;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DECLARATION â†’ ENABLE BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('declCheck').addEventListener('change', function() {
  document.getElementById('btnSub').disabled = !this.checked;
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM LISTENERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('mainForm').addEventListener('input',  function() { buildSummary(); updateProgress(); });
document.getElementById('mainForm').addEventListener('change', function() { buildSummary(); updateProgress(); });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('mainForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  var checks = [
    {id:'fn',    lbl:'Primer Nombre'},
    {id:'fa',    lbl:'Primer Apellido'},
    {id:'sa',    lbl:'Segundo Apellido'},
    {id:'gen',   lbl:'GÃ©nero'},
    {id:'dob',   lbl:'Fecha de Nacimiento'},
    {id:'rfc',   lbl:'RFC'},
    {id:'curp',  lbl:'CURP'},
    {id:'cp',    lbl:'CÃ³digo Postal'},
    {id:'estado',lbl:'Estado'},
    {id:'mun',   lbl:'Municipio'},
    {id:'tel',   lbl:'TelÃ©fono'},
    {id:'email', lbl:'Correo ElectrÃ³nico'},
    {id:'cond',  lbl:'CondiciÃ³n del VehÃ­culo'},
    {id:'ver',   lbl:'VersiÃ³n / Trim'},
    {id:'anio',  lbl:'AÃ±o Modelo'},
    {id:'niv',   lbl:'NÃºmero de Serie'},
  ];

  for (var i = 0; i < checks.length; i++) {
    var el = document.getElementById(checks[i].id);
    if (!el || !el.value.trim()) {
      if (el) { el.scrollIntoView({behavior:'smooth',block:'center'}); el.focus(); }
      alert('Por favor completa el campo: ' + checks[i].lbl);
      return;
    }
  }

  if (!bVal.value.trim()) {
    bSearch.scrollIntoView({behavior:'smooth',block:'center'}); bSearch.focus();
    alert('Por favor selecciona una Marca de vehÃ­culo.');
    return;
  }
  if (otraWrap.classList.contains('on') && !otraMarca.value.trim()) {
    otraMarca.scrollIntoView({behavior:'smooth',block:'center'}); otraMarca.focus();
    alert('Por favor especifica la marca del vehÃ­culo.');
    return;
  }
  if (!RFC_RE.test(document.getElementById('rfc').value.trim())) {
    var re = document.getElementById('rfc');
    re.scrollIntoView({behavior:'smooth',block:'center'}); re.focus();
    alert('El RFC no tiene el formato correcto.');
    return;
  }
  if (!CURP_RE.test(document.getElementById('curp').value.trim())) {
    var cu = document.getElementById('curp');
    cu.scrollIntoView({behavior:'smooth',block:'center'}); cu.focus();
    alert('La CURP no tiene el formato oficial correcto.');
    return;
  }

  var btn = document.getElementById('btnSub');
  btn.disabled = true;
  btn.innerHTML = 'â³ &nbsp;Verificandoâ€¦';

  try {
    var token = await new Promise(function(resolve, reject) {
      if (typeof grecaptcha === 'undefined') { resolve('no-recaptcha'); return; }
      grecaptcha.ready(function() {
        grecaptcha.execute(SITE_KEY, {action:'submit_cotizacion'}).then(resolve).catch(reject);
      });
    });
    document.getElementById('rcToken').value = token;

    var state = attachState['AVA'];
    if (state.files.length > 0) {
      if (state.compressing) {
        btn.innerHTML = 'ğŸ—œï¸ &nbsp;Esperando compresiÃ³nâ€¦';
        var waited = 0;
        await new Promise(function(resolve) {
          var check = setInterval(function() {
            waited += 200;
            if (!state.compressing || waited >= 30000) { clearInterval(check); resolve(); }
          }, 200);
        });
      }
      if (!state.zipBlob && typeof JSZip !== 'undefined') {
        btn.innerHTML = 'ğŸ—œï¸ &nbsp;Comprimiendo documentosâ€¦';
        await new Promise(function(resolve) {
          var zip2 = new JSZip();
          var snap = state.files.slice();
          var pending2 = snap.length;
          snap.forEach(function(f) {
            var rdr = new FileReader();
            rdr.onload = function(ev) {
              zip2.file(f.name, ev.target.result);
              if (--pending2 === 0) {
                zip2.generateAsync({type:'blob',compression:'DEFLATE',compressionOptions:{level:6}})
                  .then(function(blob) { state.zipBlob = blob; resolve(); })
                  .catch(function() { resolve(); });
              }
            };
            rdr.onerror = function() { if (--pending2 === 0) resolve(); };
            rdr.readAsArrayBuffer(f);
          });
        });
      }
      if (state.zipBlob && state.zipBlob.size > MAX_ZIP_BYTES) {
        alert('â›” El ZIP comprimido supera los 5 MB (' + fmtBytes(state.zipBlob.size) + ').\nElimina algÃºn archivo antes de enviar.');
        btn.disabled = false;
        btn.innerHTML = 'ğŸ›¡ï¸ &nbsp;Enviar CotizaciÃ³n de Seguro';
        return;
      }
    }

    btn.innerHTML = 'ğŸš€ &nbsp;Enviandoâ€¦';

    var fd = new FormData(this);
    var stateAVA = attachState['AVA'];
    if (stateAVA.zipBlob) {
      var zf = new File([stateAVA.zipBlob], 'documentos_ava_'+getToday()+'.zip', {type:'application/zip'});
      fd.append('documentos', zf, zf.name);
    } else if (stateAVA.files.length > 0) {
      stateAVA.files.forEach(function(f) { fd.append('documentos', f, f.name); });
    }

    await fetch(this.action, {method:'POST', body:fd});
    showModal();
    resetForm();

  } catch(err) {
    console.error(err);
    showModal();
    resetForm();
  } finally {
    btn.disabled = !document.getElementById('declCheck').checked;
    btn.innerHTML = 'ğŸ›¡ï¸ &nbsp;Enviar CotizaciÃ³n de Seguro';
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetForm() {
  document.getElementById('mainForm').reset();
  Object.keys(attachState).forEach(function(type) {
    attachState[type] = { files:[], zipBlob:null, compressing:false, paused:false, startTime:null, elapsed:0, _runId:null };
    var fl = document.getElementById('fileList'+type); if(fl) fl.innerHTML='';
    var cp = document.getElementById('compressProgress'+type); if(cp) cp.classList.remove('show');
    var om = document.getElementById('offlineMsg'+type); if(om) om.classList.remove('show');
    hideAttachMsg(type);
    updateCapacityBar(type);
  });
  clearTimeout(compressionTimers['AVA']);
  document.getElementById('cpLoad').className = 'cp-load';
  document.getElementById('cpErr').className  = 'cp-err';
  document.getElementById('cpBox').className  = 'cp-box';
  document.getElementById('colWrap').className = 'col-wrap';
  bSearch.value = ''; bVal.value = '';
  otraWrap.classList.remove('on');
  setAF('estado','estHint',''); setAF('mun','munHint','');
  ['rfc','curp'].forEach(function(id) {
    var el = document.getElementById(id);
    el.classList.remove('field-ok','field-err');
    document.getElementById(id+'Hint').textContent = '';
    document.getElementById(id+'Hint').className   = 'fhint';
  });
  document.getElementById('declCheck').checked = false;
  document.getElementById('btnSub').disabled = true;
  setBadgeState('pending');
  updateProgress(); buildSummary();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showModal() {
  document.getElementById('modal').classList.add('on');
  document.body.style.overflow = 'hidden';
}
window.closeModal = function() {
  document.getElementById('modal').classList.remove('on');
  document.body.style.overflow = '';
};
document.getElementById('modal').addEventListener('click', function(e) {
  if (e.target === this) window.closeModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('progWrap').classList.add('on');
  setBadgeState('pending');
  updateProgress();
  buildSummary();
});
</script>
</body>
</html>
